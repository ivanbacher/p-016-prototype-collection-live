"bundle";System.registerDynamic("app.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return'<template><require from="./components/top.html"></require><require from="./components/editor"></require><top id="top" prototypes.bind="prototypes" prototype-index.two-way="prototypeIndex" file-index.two-way="fileIndex"></top><div id="main-vp"><code-editor></code-editor><router-view id="vis-viewport"></router-view></div></template>'}.call(this)}),System.register("app.js",["aurelia-framework","aurelia-event-aggregator","aurelia-router","./services/log","./../data/experiment_code/file0.js!text","./../data/experiment_code/file1.js!text","./../data/experiment_code/file4.js!text"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n,o;return{setters:[function(a){d=a.inject,e=a.TaskQueue,f=a.BindingEngine},function(a){g=a.EventAggregator},function(a){h=a.Router},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a["default"]},function(a){l=a["default"]}],execute:function(){a("App",(m=d(g,e,f),o=m(n=function(){function a(b,d,e){var f=this;c(this,a),this.EA=b,this.TQ=d,this.BE=e,this.fileIndex=0,this.prototypeIndex=0,this.files=[j,k,l],this.prototypes=["p1.1","p1.2","p1.3","p2.1","p3.1","p3.2","p3.3","p4.1","p4.2","p4.3","p4.4","p4.5","p4.6","p4.7","p4.8","p5.1","p5.2","p6.1","p6.2"],this.subscriptions=[];var g=this.BE.propertyObserver(this,"prototypeIndex").subscribe(function(a,b){console.log(b+" to "+a),f.prototypeIndex=a;var c=f.prototypes[f.prototypeIndex];try{f.router.navigateToRoute(c).then(function(){f.loadCode()})}catch(d){f.loadCode()}}),h=this.BE.propertyObserver(this,"fileIndex").subscribe(function(a,b){f.fileIndex=a,f.loadCode()});this.subscriptions.push(g),this.subscriptions.push(h)}return a.prototype.configureRouter=function(a,b){a.map([{route:"",redirect:"p1.1",nav:!1},{route:"p1.1",name:"p1.1",moduleId:"./prototypes/p1-1",nav:!1},{route:"p1.2",name:"p1.2",moduleId:"./prototypes/p1-2",nav:!1},{route:"p1.3",name:"p1.3",moduleId:"./prototypes/p1-3",nav:!1},{route:"p2.1",name:"p2.1",moduleId:"./prototypes/p2-1",nav:!1},{route:"p3.1",name:"p3.1",moduleId:"./prototypes/p3-1",nav:!1},{route:"p3.2",name:"p3.2",moduleId:"./prototypes/p3-2",nav:!1},{route:"p3.3",name:"p3.3",moduleId:"./prototypes/p3-3",nav:!1},{route:"p4.1",name:"p4.1",moduleId:"./prototypes/p4-1",nav:!1},{route:"p4.2",name:"p4.2",moduleId:"./prototypes/p4-2",nav:!1},{route:"p4.3",name:"p4.3",moduleId:"./prototypes/p4-3",nav:!1},{route:"p4.4",name:"p4.4",moduleId:"./prototypes/p4-4",nav:!1},{route:"p4.5",name:"p4.5",moduleId:"./prototypes/p4-5",nav:!1},{route:"p4.6",name:"p4.6",moduleId:"./prototypes/p4-6",nav:!1},{route:"p4.7",name:"p4.7",moduleId:"./prototypes/p4-7",nav:!1},{route:"p4.8",name:"p4.8",moduleId:"./prototypes/p4-8",nav:!1},{route:"p5.1",name:"p5.1",moduleId:"./prototypes/p5-1",nav:!1},{route:"p5.2",name:"p5.2",moduleId:"./prototypes/p5-2",nav:!1},{route:"p6.1",name:"p6.1",moduleId:"./prototypes/p6-1",nav:!1},{route:"p6.2",name:"p6.2",moduleId:"./prototypes/p6-2",nav:!1}]),this.router=b},a.prototype.activate=function(){i.info("App activate")},a.prototype.attached=function(){i.info("App attached");var a=this.router.currentInstruction.config.name;this.prototypeIndex=this.prototypes.findIndex(function(b){return b===a})},a.prototype.loadCode=function(){var a=this;this.TQ.queueMicroTask(function(){i.info("Loading Code File"),a.EA.publish("load_code",{data:a.files[a.fileIndex]})})},a.prototype.detached=function(){i.info("App detached");for(var a=subscriptions,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a}())||n)),a("App",o)}}}),System.register("components/editor.js",["aurelia-framework","aurelia-event-aggregator","../services/log","d3","CodeMirror","CodeMirror/mode/javascript/javascript.js","CodeMirror/lib/codemirror.css!css","CodeMirror/addon/fold/foldcode.js","CodeMirror/addon/fold/foldgutter.js","CodeMirror/addon/fold/brace-fold.js","CodeMirror/addon/fold/foldgutter.css!css","CodeMirror/addon/search/search.js","CodeMirror/addon/search/searchcursor.js","CodeMirror/addon/search/jump-to-line.js","CodeMirror/addon/dialog/dialog.js","CodeMirror/addon/dialog/dialog.css!css"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n;return{setters:[function(a){d=a.inject,e=a.noView,f=a.bindable},function(a){g=a.EventAggregator},function(a){h=a.log},function(a){i=a},function(a){j=a["default"]},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){}],execute:function(){a("CodeEditorCustomElement",(k=d(Element,g),l=e(),n=k(m=l(m=function(){function a(b,d,e){c(this,a),h.info("code-editor created"),this.element=b,this.eventAggregator=d,this.subs=[],this.markers=[]}return a.prototype.attached=function(){var a=this;h.info("code-editor attached");var b=j(this.element,{mode:"javascript",lineNumbers:!0,foldGutter:!0,readOnly:!1,scrollbarStyle:"null",gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]});b.setSize("100%","100%"),b.on("change",function(b,c){h.info("codemirror change event");var d=[];b.eachLine(function(a){var c=a.lineNo(),e=b.getLineTokens(a.lineNo(c));e.row=c,d.push(e)}),a.eventAggregator.publish("draw_001",{lines:d,content:b.getValue()})}),b.on("cursorActivity",function(c){h.info("codemirror cursorActivity event");var d=b.getCursor();a.eventAggregator.publish("cursorActivity",{line:d.line,column:d.ch});var e=b.getSelection();e.trim().length>=1&&a.eventAggregator.publish("editorTextSelection",{selection:e})}),b.on("scroll",function(){var c=b.getScrollInfo(),d=b.lineAtHeight(Math.ceil(c.top),"local"),e=b.lineAtHeight(Math.ceil(c.top+c.clientHeight+20),"local");a.eventAggregator.publish("cm_editor_scroll",{info:c,start_line:d,end_line:e})});var c=this.eventAggregator.subscribe("load_code",function(c){h.info("codemirror - load code event"),b.setValue(c.data);var d=b.getScrollInfo(),e=b.lineAtHeight(d.top,"local"),f=b.lineAtHeight(d.top+d.clientHeight,"local");a.eventAggregator.publish("cm_editor_scroll",{info:d,start_line:e,end_line:f})}),d=this.eventAggregator.subscribe("highlight_scope",function(c){var d=c.range,e=b.markText({line:d.start.line,ch:d.start.column},{line:d.end.line,ch:d.end.column},{className:"styled-background"});a.markers.push(e)}),e=this.eventAggregator.subscribe("unhighlight_scope",function(b){for(var c=a.markers,d=Array.isArray(c),e=0,c=d?c:c[Symbol.iterator]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{if(e=c.next(),e.done)break;f=e.value}var g=f;g.clear()}a.markers=[]}),f=this.eventAggregator.subscribe("move_cursor",function(a){var c=a.line;b.scrollIntoView({line:c,ch:0}),b.focus()}),g=this.eventAggregator.subscribe("scroll_wheel_event",function(a){var c=b.getScrollInfo(),d=0,e=c.top+a.deltaY;b.scrollTo(d,e)}),k=this.eventAggregator.subscribe("trigger_change",function(){var c=[];b.eachLine(function(a){var d=a.lineNo(),e=b.getLineTokens(a.lineNo(d));e.row=d,c.push(e)}),a.eventAggregator.publish("draw_001",{lines:c,content:b.getValue()});var d=b.getCursor();a.eventAggregator.publish("cursorActivity",{line:d.line,column:d.ch});var e=b.getSelection();e.trim().length>=1&&a.eventAggregator.publish("editorTextSelection",{selection:e});var f=b.getScrollInfo(),g=b.lineAtHeight(Math.ceil(f.top),"local"),h=b.lineAtHeight(Math.ceil(f.top+f.clientHeight+20),"local");a.eventAggregator.publish("cm_editor_scroll",{info:f,start_line:g,end_line:h})}),l=this.eventAggregator.subscribe("mousemove_event",function(a){var c=b.getScrollInfo(),d=i.scaleLinear().domain([0,a.total_h]).range([0,c.height]),e=0,f=c.top+d(a.deltaY);b.scrollTo(e,f)});this.subs.push(c),this.subs.push(d),this.subs.push(e),this.subs.push(f),this.subs.push(g),this.subs.push(k),this.subs.push(l)},a.prototype.detached=function(){h.info("code-editor detached");for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a}())||m)||m)),a("CodeEditorCustomElement",n)}}}),System.registerDynamic("components/top.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return'<template bindable="prototypes, prototypeIndex, fileIndex"><div class="container-fluid"><div class="row mt-1"><div class="col-5"><div class="form-inline"><div class="form-group"><label for="prototype-selection">Prototype:</label> <select class="form-control mx-sm-3" id="prototype-selection" value.bind="prototypeIndex"><option repeat.for="prototype of prototypes" model.bind="$index">${prototype}</option></select></div></div></div><div class="col-5"><div class="form-inline"><div class="form-group"><label for="code-selection">Code Examples:</label> <select class="form-control mx-sm-3" id="code-selection" value.bind="fileIndex"><option value="0">Example 1</option><option value="1">Example 2</option><option value="2">Example 3</option></select></div></div></div></div></div></template>'}.call(this)}),System.register("main.js",["aurelia-framework","aurelia-logging-console","bootstrap","bootstrap/dist/css/bootstrap.min.css!"],function(a,b){"use strict";function c(a){a.use.standardConfiguration(),a.start().then(function(){return a.setRoot("app")})}var d,e;return a("configure",c),{setters:[function(a){d=a.LogManager},function(a){e=a.ConsoleAppender},function(a){},function(a){}],execute:function(){d.addAppender(new e),d.setLevel(d.logLevel.debug)}}}),System.registerDynamic("prototypes/p1-1.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p1-1.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","jquery","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l;return{setters:[function(a){d=a.inject},function(a){e=a.EventAggregator},function(a){f=a.log},function(a){g=a["default"]},function(a){h=a["default"]},function(a){i=a}],execute:function(){a("P1_1",(j=d(e),l=j(k=function(){function a(b){c(this,a),f.info("P1-1 created"),this.eventAggregator=b,this.subs=[],this.local_s_marker,this.var_s_marker,this.layout_info={line_spacing:4,char_h:3,char_w:2},this.scopes=[],this.scopeTree={},this.currentScope=null,this.mousedown=!1,this.mouseDownOnViewPort=!1}return a.prototype.attached=function(){var a=this;f.info("P1-1 attached"),this.element=document.querySelector("#vis-viewport"),f.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=i.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight).on("click",function(){a.svg_click(i.event)}).on("wheel",function(){a.svg_wheel(i.event)}).on("mousedown",function(){a.svg_mousedown(i.event)}).on("mouseup",function(){a.svg_mouseup(i.event)}).on("mousemove",function(){a.svg_mousemove(i.event)}),h(window).resize(function(){f.info("window resize"),a.svg.attr("width",a.element.clientWidth),a.svg.attr("height",a.element.clientHeight),a.eventAggregator.publish("trigger_change")});var b=this.svg.append("g").attr("id","baseLayer").attr("transform","translate( 4, 4 )");b.append("g").attr("id","layer-1"),b.append("g").attr("id","layer-3"),b.append("g").attr("id","layer-2"),b.append("g").attr("id","layer-4").attr("pointer-events","none").append("rect").attr("id","current_viewport");var c=this.eventAggregator.subscribe("draw_001",function(b){f.info("P1-1 -- draw_001 event");var c=(b.content,b.lines),d=a.calculate_minimap_layout(c);a.draw_minimap(d)}),d=this.eventAggregator.subscribe("cm_editor_scroll",function(b){var c=b.info,d=a.svg.select("#layer-1").selectAll(".line").size(),e=d*(a.layout_info.char_h+a.layout_info.line_spacing),f=i.scaleLinear().domain([0,c.height]).range([0,e]),g=e/c.height,h=c.clientHeight*g,j=a.svg.attr("width"),k=0,l=f(c.top);if(a.draw_viewport(k,l,j,h),e>c.clientHeight){f=i.scaleLinear().domain([0,c.height-c.clientHeight]).range([4,-(e-c.clientHeight)]);var m=f(c.top);a.svg.select("#baseLayer").attr("transform","translate( 4, "+m+" )")}});this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){f.info("P1-1 detached"),h(window).off("resize"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.calculate_minimap_layout=function(a){for(var b=this.layout_info.line_spacing,c=this.layout_info.char_h,d=this.layout_info.char_w,e=[],f=b/2,g=a,h=Array.isArray(g),i=0,g=h?g:g[Symbol.iterator]();;){var j;if(h){if(i>=g.length)break;j=g[i++]}else{if(i=g.next(),i.done)break;j=i.value}for(var k=j,l={x:0,y:f,row:k.row,blocks:[]},m=0,n=k,o=Array.isArray(n),p=0,n=o?n:n[Symbol.iterator]();;){var q;if(o){if(p>=n.length)break;q=n[p++]}else{if(p=n.next(),p.done)break;q=p.value}var r=q,s={x:m,y:0,h:c,w:d*(r.end-r.start),type:r.type,string:r.string,start:r.start,end:r.end,row:k.row};null===r.type&&(0===r.string.trim().length?s.type="whitespace":s.type="character"),l.blocks.push(s),m+=d*(r.end-r.start)}e.push(l),f+=c+b}return e},a.prototype.draw_minimap=function(a){var b=this.svg.select("#layer-1");b.selectAll("*").remove();var c=b.selectAll("lines").data(a).enter().append("g").attr("id",function(a){return"line "+(a.row+1)}).attr("class","line").attr("transform",function(a){return"translate( "+a.x+", "+a.y+" )"});c.selectAll("blocks").data(function(a){return a.blocks}).enter().append("rect").attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return a.w}).attr("height",function(a){return a.h}).attr("fill","black").attr("fill-opacity",function(a){return"whitespace"==a.type?0:.65})},a.prototype.draw_viewport=function(a,b,c,d){var e=this.svg.select("#layer-4").select("#current_viewport");e.attr("x",a).attr("y",b).attr("width",c).attr("height",d).attr("fill","#94a7ba").attr("opacity","0.2")},a.prototype.svg_click=function(a){if(this.svg_mousedown(a))return void(this.mouseDownOnViewPort=!1);var b=a.layerY,c=this.svg.select("#baseLayer").attr("transform");c=c.replace("translate(",""),c=c.replace(")",""),c=c.split(",");var d=(parseInt(c[0]),parseInt(c[1]));b+=Math.abs(d);var e=this.layout_info.char_h,f=this.layout_info.line_spacing,g=this.svg.select("#layer-1").selectAll(".line").size(),h=g*(e+f)-f/2;if(!(b>h)){var i=0;this.svg.select("#layer-1").selectAll(".line").each(function(a){var c=a.y,d=a.y+e+f;b>=c&&b<=d&&(i=a.row)});var j=this.svg.select("#layer-4").select("#current_viewport"),k=parseInt(j.attr("height"))/(e+f);if(b<parseInt(j.attr("y"))){var l=Math.round(i-k/2);l<0&&(l=0),this.eventAggregator.publish("move_cursor",{line:l})}else{var m=Math.round(i+k/2);m>g&&(m=g-1),this.eventAggregator.publish("move_cursor",{line:m})}}},a.prototype.svg_wheel=function(a){a.preventDefault(),this.eventAggregator.publish("scroll_wheel_event",{deltaX:a.deltaX,deltaY:a.deltaY})},a.prototype.svg_mousedown=function(a){this.mousedown=!0;var b=this.svg.select("#baseLayer").attr("transform");b=b.replace("translate(",""),b=b.replace(")",""),b=b.split(",");var c=(parseInt(b[0]),parseInt(b[1])),d=this.svg.select("#layer-4").select("#current_viewport"),e=a.layerY,f=parseInt(d.attr("y"))+c,g=f+parseInt(d.attr("height"));if(e>=f&&e<=g)return this.mouseDownOnViewPort=!0,!0},a.prototype.svg_mouseup=function(){this.mousedown=!1,this.mouseDownOnViewPort=!1},a.prototype.svg_mousemove=function(a){if(this.mousedown&&this.mouseDownOnViewPort){var b=this.svg.select("#layer-1").selectAll(".line").size(),c=b*(this.layout_info.char_h+this.layout_info.line_spacing);this.eventAggregator.publish("mousemove_event",{total_h:c,deltaX:a.movementX,deltaY:a.movementY})}},a}())||k)),a("P1_1",l)}}}),System.registerDynamic("prototypes/p1-2.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p1-2.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","jquery","d3","../helpers/minimap_helper.js"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n;return{setters:[function(a){d=a.inject},function(a){e=a.EventAggregator},function(a){f=a.log},function(a){g=a["default"]},function(a){h=a["default"]},function(a){i=a},function(a){j=a.MINIMAP_CHAR_STYLES,k=a.SCOPE_STYLES}],execute:function(){console.log(i.version),a("P1_2",(l=d(e),n=l(m=function(){function a(b){c(this,a),f.info("P1-2 created"),this.eventAggregator=b,this.subs=[],this.local_s_marker,this.var_s_marker,this.layout_info={line_spacing:4,char_h:3,char_w:2},this.scopes=[],this.scopeTree={},this.currentScope=null,this.mousedown=!1,this.mouseDownOnViewPort=!1}return a.prototype.attached=function(){var a=this;f.info("P1-2 attached"),this.element=document.querySelector("#vis-viewport"),f.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=i.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight).on("click",function(){a.svg_click(i.event)}).on("wheel",function(){a.svg_wheel(i.event)}).on("mousedown",function(){a.svg_mousedown(i.event)}).on("mouseup",function(){a.svg_mouseup(i.event)}).on("mousemove",function(){a.svg_mousemove(i.event)}),h(window).resize(function(){f.info("window resize"),a.svg.attr("width",a.element.clientWidth),a.svg.attr("height",a.element.clientHeight),a.eventAggregator.publish("trigger_change")});var b=this.svg.append("g").attr("id","baseLayer").attr("transform","translate( 4, 4 )");b.append("g").attr("id","layer-1"),b.append("g").attr("id","layer-3"),b.append("g").attr("id","layer-2"),b.append("g").attr("id","layer-4").attr("pointer-events","none").append("rect").attr("id","current_viewport");var c=this.eventAggregator.subscribe("draw_001",function(b){f.info("P1-2 -- draw_001 event");var c=(b.content,b.lines),d=a.calculate_minimap_layout(c);a.draw_minimap(d)}),d=this.eventAggregator.subscribe("cm_editor_scroll",function(b){var c=b.info,d=a.svg.select("#layer-1").selectAll(".line").size(),e=d*(a.layout_info.char_h+a.layout_info.line_spacing),f=i.scaleLinear().domain([0,c.height]).range([0,e]),g=e/c.height,h=c.clientHeight*g,j=a.svg.attr("width"),k=0,l=f(c.top);if(a.draw_viewport(k,l,j,h),e>c.clientHeight){f=i.scaleLinear().domain([0,c.height-c.clientHeight]).range([4,-(e-c.clientHeight)]);var m=f(c.top);a.svg.select("#baseLayer").attr("transform","translate( 4, "+m+" )")}});this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){f.info("P1-2 detached"),h(window).off("resize"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.calculate_minimap_layout=function(a){for(var b=this.layout_info.line_spacing,c=this.layout_info.char_h,d=this.layout_info.char_w,e=[],f=b/2,g=a,h=Array.isArray(g),i=0,g=h?g:g[Symbol.iterator]();;){var j;if(h){if(i>=g.length)break;j=g[i++]}else{if(i=g.next(),i.done)break;j=i.value}for(var k=j,l={x:0,y:f,row:k.row,blocks:[]},m=0,n=k,o=Array.isArray(n),p=0,n=o?n:n[Symbol.iterator]();;){var q;if(o){if(p>=n.length)break;q=n[p++]}else{if(p=n.next(),p.done)break;q=p.value}var r=q,s={x:m,y:0,h:c,w:d*(r.end-r.start),type:r.type,string:r.string,start:r.start,end:r.end,row:k.row};null===r.type&&(0===r.string.trim().length?s.type="whitespace":s.type="character"),l.blocks.push(s),m+=d*(r.end-r.start)}e.push(l),f+=c+b}return e},a.prototype.draw_minimap=function(a){var b=this.svg.select("#layer-1");b.selectAll("*").remove();var c=b.selectAll("lines").data(a).enter().append("g").attr("id",function(a){return"line "+(a.row+1)}).attr("class","line").attr("transform",function(a){return"translate( "+a.x+", "+a.y+" )"});c.selectAll("blocks").data(function(a){return a.blocks}).enter().append("rect").attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return a.w}).attr("height",function(a){return a.h}).attr("fill",function(a){return j["default"][a.type]}).attr("fill-opacity",function(a){return"whitespace"==a.type?0:.65})},a.prototype.draw_viewport=function(a,b,c,d){var e=this.svg.select("#layer-4").select("#current_viewport");e.attr("x",a).attr("y",b).attr("width",c).attr("height",d).attr("fill","#94a7ba").attr("opacity","0.2")},a.prototype.svg_click=function(a){if(this.svg_mousedown(a))return void(this.mouseDownOnViewPort=!1);var b=a.layerY,c=this.svg.select("#baseLayer").attr("transform");c=c.replace("translate(",""),c=c.replace(")",""),c=c.split(",");var d=(parseInt(c[0]),parseInt(c[1]));b+=Math.abs(d);var e=this.layout_info.char_h,f=this.layout_info.line_spacing,g=this.svg.select("#layer-1").selectAll(".line").size(),h=g*(e+f)-f/2;if(!(b>h)){var i=0;this.svg.select("#layer-1").selectAll(".line").each(function(a){var c=a.y,d=a.y+e+f;b>=c&&b<=d&&(i=a.row)});var j=this.svg.select("#layer-4").select("#current_viewport"),k=parseInt(j.attr("height"))/(e+f);if(b<parseInt(j.attr("y"))){var l=Math.round(i-k/2);l<0&&(l=0),this.eventAggregator.publish("move_cursor",{line:l})}else{var m=Math.round(i+k/2);m>g&&(m=g-1),this.eventAggregator.publish("move_cursor",{line:m})}}},a.prototype.svg_wheel=function(a){a.preventDefault(),this.eventAggregator.publish("scroll_wheel_event",{deltaX:a.deltaX,deltaY:a.deltaY})},a.prototype.svg_mousedown=function(a){this.mousedown=!0;var b=this.svg.select("#baseLayer").attr("transform");b=b.replace("translate(",""),b=b.replace(")",""),b=b.split(",");var c=(parseInt(b[0]),parseInt(b[1])),d=this.svg.select("#layer-4").select("#current_viewport"),e=a.layerY,f=parseInt(d.attr("y"))+c,g=f+parseInt(d.attr("height"));if(e>=f&&e<=g)return this.mouseDownOnViewPort=!0,!0},a.prototype.svg_mouseup=function(){this.mousedown=!1,this.mouseDownOnViewPort=!1},a.prototype.svg_mousemove=function(a){if(this.mousedown&&this.mouseDownOnViewPort){var b=this.svg.select("#layer-1").selectAll(".line").size(),c=b*(this.layout_info.char_h+this.layout_info.line_spacing);this.eventAggregator.publish("mousemove_event",{total_h:c,deltaX:a.movementX,deltaY:a.movementY})}},a}())||m)),a("P1_2",n)}}}),System.registerDynamic("prototypes/p1-3.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("helpers/minimap_helper.js",[],function(a,b){"use strict";var c,d;return{setters:[],execute:function(){a("MINIMAP_CHAR_STYLES",c={"default":{keyword:"#708",atom:"#219",number:"#164",def:"#00f",variable:"black",punctuation:"black",property:"black",operator:"black","variable-2":"#05a","variable-3":"#085",type:"#085",comment:"#a50",string:"#a11","string-2":"#f50",meta:"#555",qualifier:"#555",builtin:"#30a",bracket:"#997",tag:"#170",attribute:"#00c",hr:"#999",link:"#00c",error:"#f00",invalidchar:"#f00",character:"black",whitespace:"none"}}),a("SCOPE_STYLES",d={current:{background:"#FFFF77"},hoisting:{background:"white",border:"red"}}),a("MINIMAP_CHAR_STYLES",c),a("SCOPE_STYLES",d)}}}),System.register("prototypes/p1-3.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","jquery","d3","../helpers/minimap_helper.js"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}var e,f,g,h,i,j,k,l,m,n,o;return{setters:[function(a){e=a.inject},function(a){f=a.EventAggregator},function(a){g=a.log},function(a){h=a["default"]},function(a){i=a["default"]},function(a){j=a},function(a){k=a.MINIMAP_CHAR_STYLES,l=a.SCOPE_STYLES}],execute:function(){a("P1_3",(m=e(f),o=m(n=function(){function a(b){c(this,a),g.info("P1-3 created"),this.eventAggregator=b,this.subs=[],this.local_s_marker,this.var_s_marker,this.layout_info={line_spacing:4,char_h:3,char_w:2},this.scopes=[],this.scopeTree={},this.currentScope=null,this.mousedown=!1,this.mouseDownOnViewPort=!1}return a.prototype.attached=function(){var a=this;g.info("P1-3 attached"),this.element=document.querySelector("#vis-viewport"),g.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=j.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight).on("click",function(){a.svg_click(j.event)}).on("wheel",function(){a.svg_wheel(j.event)}).on("mousedown",function(){a.svg_mousedown(j.event)}).on("mouseup",function(){a.svg_mouseup(j.event)}).on("mousemove",function(){a.svg_mousemove(j.event)}),i(window).resize(function(){g.info("window resize"),a.svg.attr("width",a.element.clientWidth),a.svg.attr("height",a.element.clientHeight),a.eventAggregator.publish("trigger_change")});var b=this.svg.append("g").attr("id","baseLayer").attr("transform","translate( 4, 4 )");b.append("g").attr("id","layer-1"),b.append("g").attr("id","layer-3"),b.append("g").attr("id","layer-2"),b.append("g").attr("id","layer-4").attr("pointer-events","none").append("rect").attr("id","current_viewport");var c=this.eventAggregator.subscribe("draw_001",function(b){g.info("P1-3 -- draw_001 event");var c=b.content,d=b.lines,e=a.calculate_minimap_layout(d);a.draw_minimap(e);var f=h.parse_ast(c),i=h.parse_scope(f);a.scopes=[],a.scopeTree=i,h.traverse_scope(i,function(b,c){var e=b.block.loc.start.line-1,f=b.block.loc.start.column,g=b.block.loc.end.line-1,h=b.block.loc.end.column,i={};i="global"===b.type?{start:{line:0,column:-(1/0)},end:{line:d.length-1,column:1/0}}:{start:{line:e,column:f},end:{line:g,column:h}},b.block.loc2=i,a.scopes.push(b)})}),d=this.eventAggregator.subscribe("cursorActivity",function(b){g.info("P1-3 -- cursorActivity event"),a.svg.select("#layer-3").selectAll("*").remove();var c=a.find_scope_range(b),d=a.calculate_scope_layout(c.block.loc2);a.draw_scope(d,c.block.loc2),a.currentScope=c}),e=this.eventAggregator.subscribe("editorTextSelection",function(b){g.info("code-minimap -- editorTextSelection event");var c=a.find_var_in_current_scope(a.currentScope,b.selection);if(c){var d=a.calculate_scope_layout(c);a.draw_var_scope(d,c)}else a.svg.select("#layer-3").selectAll("*").remove()}),f=this.eventAggregator.subscribe("cm_editor_scroll",function(b){var c=b.info,d=a.svg.select("#layer-1").selectAll(".line").size(),e=d*(a.layout_info.char_h+a.layout_info.line_spacing),f=j.scaleLinear().domain([0,c.height]).range([0,e]),g=e/c.height,h=c.clientHeight*g,i=a.svg.attr("width"),k=0,l=f(c.top);if(a.draw_viewport(k,l,i,h),e>c.clientHeight){f=j.scaleLinear().domain([0,c.height-c.clientHeight]).range([4,-(e-c.clientHeight)]);var m=f(c.top);a.svg.select("#baseLayer").attr("transform","translate( 4, "+m+" )")}});this.subs.push(c),this.subs.push(d),this.subs.push(e),this.subs.push(f)},a.prototype.detached=function(){g.info("P1-3 detached"),i(window).off("resize"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.calculate_minimap_layout=function(a){for(var b=this.layout_info.line_spacing,c=this.layout_info.char_h,d=this.layout_info.char_w,e=[],f=b/2,g=a,h=Array.isArray(g),i=0,g=h?g:g[Symbol.iterator]();;){var j;if(h){if(i>=g.length)break;j=g[i++]}else{if(i=g.next(),i.done)break;j=i.value}for(var k=j,l={x:0,y:f,row:k.row,blocks:[]},m=0,n=k,o=Array.isArray(n),p=0,n=o?n:n[Symbol.iterator]();;){var q;if(o){if(p>=n.length)break;q=n[p++]}else{if(p=n.next(),p.done)break;q=p.value}var r=q,s={x:m,y:0,h:c,w:d*(r.end-r.start),type:r.type,string:r.string,start:r.start,end:r.end,row:k.row};null===r.type&&(0===r.string.trim().length?s.type="whitespace":s.type="character"),l.blocks.push(s),m+=d*(r.end-r.start)}e.push(l),f+=c+b}return e},a.prototype.draw_minimap=function(a){var b=this.svg.select("#layer-1");b.selectAll("*").remove();var c=b.selectAll("lines").data(a).enter().append("g").attr("id",function(a){return"line "+(a.row+1)}).attr("class","line").attr("transform",function(a){return"translate( "+a.x+", "+a.y+" )"});c.selectAll("blocks").data(function(a){return a.blocks}).enter().append("rect").attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return a.w}).attr("height",function(a){return a.h}).attr("fill",function(a){return k["default"][a.type]}).attr("fill-opacity",function(a){return"whitespace"==a.type?0:.65})},a.prototype.draw_scope=function(a,b){var c=this,d=this.svg.select("#layer-2");d.selectAll("*").remove();var e=j.line().x(function(a){return a.x}).y(function(a){return a.y});d.selectAll("scope").data([a]).enter().append("path").attr("d",e).attr("fill",l.current.background).attr("fill-opacity",.7).on("mouseover",function(){c.eventAggregator.publish("highlight_scope",{range:b})}).on("mouseout",function(){c.eventAggregator.publish("unhighlight_scope",{range:b})})},a.prototype.draw_var_scope=function(a,b){var c=this,d=this.svg.select("#layer-3");d.selectAll("*").remove();var e=j.line().x(function(a){return a.x}).y(function(a){return a.y});d.selectAll("scope").data([a]).enter().append("path").attr("d",e).attr("stroke",l.hoisting.border).attr("stroke-width",2).attr("fill",l.hoisting.background).attr("fill-opacity",0).on("mouseover",function(){c.eventAggregator.publish("highlight_scope",{range:b})}).on("mouseout",function(){c.eventAggregator.publish("unhighlight_scope",{range:b})})},a.prototype.draw_viewport=function(a,b,c,d){var e=this.svg.select("#layer-4").select("#current_viewport");e.attr("x",a).attr("y",b).attr("width",c).attr("height",d).attr("fill","#94a7ba").attr("opacity","0.2")},a.prototype.find_scope_range=function(a){for(var b=null,c=this.scopes,e=Array.isArray(c),f=0,c=e?c:c[Symbol.iterator]();;){var g;if(e){if(f>=c.length)break;g=c[f++]}else{if(f=c.next(),f.done)break;g=f.value}var h=g;d(a,h.block.loc2)&&(b=h)}return b},a.prototype.calculate_scope_layout=function(a){function b(a,b){if(0===a.length){var c=b*(j+h)+h/2;return{s:{x:0,y:c},e:{x:i,y:c}}}for(var d={x:+(1/0),y:+(1/0)},e={x:-(1/0),y:-(1/0)},f=a,g=Array.isArray(f),k=0,f=g?f:f[Symbol.iterator]();;){var l;if(g){if(k>=f.length)break;l=f[k++]}else{if(k=f.next(),k.done)break;l=k.value}var m=l,n=m.start*i,o=m.end*i,p=m.row*(j+h)+h/2;n<d.x&&(d.x=n,d.y=p),o>e.x&&(e.x=o,e.y=p)}return{s:d,e:e}}var c=[],d=this.svg.select("#layer-1").selectAll(".line"),e=d.filter(function(b){return b.row===a.start.line}),f=d.filter(function(b){return b.row>a.start.line&&b.row<a.end.line}),g=d.filter(function(b){return b.row===a.end.line}),h=this.layout_info.line_spacing,i=this.layout_info.char_w,j=this.layout_info.char_h,k=h/2,l=j+h/2,m=b(e.datum().blocks.filter(function(b){return b.start>=a.start.column}),e.datum().row);if(c.push({x:m.s.x,y:m.s.y+l}),c.push({x:m.s.x,y:m.s.y-k}),c.push({x:m.e.x,y:m.e.y-k}),c.push({x:m.e.x,y:m.e.y+l}),e.datum().row===g.datum().row)return c.push({x:m.s.x,y:m.s.y+l}),c.push({x:m.s.x,y:m.s.y-k}),c;f.each(function(a){var d=b(a.blocks,a.row);c.push({x:d.e.x,y:d.e.y-k}),c.push({x:d.e.x,y:d.e.y+l})});var n=b(g.datum().blocks.filter(function(b){return b.end<=a.end.column}),g.datum().row);return c.push({x:n.e.x,y:n.e.y-k}),c.push({x:n.e.x,y:n.e.y+l}),c.push({x:n.s.x,y:n.s.y+l}),c.push({x:n.s.x,y:n.s.y-k}),m.s.x>0?(c.push({x:n.s.x,y:m.s.y+l}),c.push({x:m.s.x,y:m.s.y+l}),c.push({x:m.s.x,y:m.s.y-k})):c.push({x:n.s.x,
y:m.s.y+l}),c},a.prototype.find_var_in_current_scope=function(a,b){return function c(a,b){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(b===h.name)return a.block.loc2}if(a.upper)return c(a.upper,b)}(a,b)},a.prototype.svg_click=function(a){if(this.svg_mousedown(a))return void(this.mouseDownOnViewPort=!1);var b=a.layerY,c=this.svg.select("#baseLayer").attr("transform");c=c.replace("translate(",""),c=c.replace(")",""),c=c.split(",");var d=(parseInt(c[0]),parseInt(c[1]));b+=Math.abs(d);var e=this.layout_info.char_h,f=this.layout_info.line_spacing,g=this.svg.select("#layer-1").selectAll(".line").size(),h=g*(e+f)-f/2;if(!(b>h)){var i=0;this.svg.select("#layer-1").selectAll(".line").each(function(a){var c=a.y,d=a.y+e+f;b>=c&&b<=d&&(i=a.row)});var j=this.svg.select("#layer-4").select("#current_viewport"),k=parseInt(j.attr("height"))/(e+f);if(b<parseInt(j.attr("y"))){var l=Math.round(i-k/2);l<0&&(l=0),this.eventAggregator.publish("move_cursor",{line:l})}else{var m=Math.round(i+k/2);m>g&&(m=g-1),this.eventAggregator.publish("move_cursor",{line:m})}}},a.prototype.svg_wheel=function(a){a.preventDefault(),this.eventAggregator.publish("scroll_wheel_event",{deltaX:a.deltaX,deltaY:a.deltaY})},a.prototype.svg_mousedown=function(a){this.mousedown=!0;var b=this.svg.select("#baseLayer").attr("transform");b=b.replace("translate(",""),b=b.replace(")",""),b=b.split(",");var c=(parseInt(b[0]),parseInt(b[1])),d=this.svg.select("#layer-4").select("#current_viewport"),e=a.layerY,f=parseInt(d.attr("y"))+c,g=f+parseInt(d.attr("height"));if(e>=f&&e<=g)return this.mouseDownOnViewPort=!0,!0},a.prototype.svg_mouseup=function(){this.mousedown=!1,this.mouseDownOnViewPort=!1},a.prototype.svg_mousemove=function(a){if(this.mousedown&&this.mouseDownOnViewPort){var b=this.svg.select("#layer-1").selectAll(".line").size(),c=b*(this.layout_info.char_h+this.layout_info.line_spacing);this.eventAggregator.publish("mousemove_event",{total_h:c,deltaX:a.movementX,deltaY:a.movementY})}},a}())||n)),a("P1_3",o)}}}),System.registerDynamic("prototypes/p2-1.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p2-1.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b,c,d,e){var f={id:a,type:b,level:c,points:d,loc:e};return f}function e(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}var f,g,h,i,j,k,l,m;return{setters:[function(a){f=a.inject},function(a){g=a.EventAggregator},function(a){h=a.log},function(a){i=a["default"]},function(a){j=a}],execute:function(){a("P2_1",(k=f(g),m=k(l=function(){function a(b){c(this,a),h.info("P2_1 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;h.info("P2_1 attached"),this.element=document.querySelector("#vis-viewport"),h.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=j.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight),this.layers={one:this.svg.append("g").attr("id","layer-1"),two:this.svg.append("g").attr("id","layer-2")},this.layers.one.attr("transform",function(a){return"translate(5,5)"}),this.layers.two.attr("transform",function(a){return"translate(5,5)"});var b=this.eventAggregator.subscribe("draw_001",function(b){h.info("P2_1 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){h.info("P2_1 -- cursorActivity event"),a.highlight_current_scope(b)});this.subs.push(b),this.subs.push(c)},a.prototype.detached=function(){h.info("P2_1 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function b(a){var c=this,e=4,f=3,g=1.5,h=1.5,j=g+e+h,k=80,l=k*f,m=a.split("\n").length,n=i.parse_ast(a),o=i.parse_scope(n),b=[],p=0;return this.scopes=[],i.traverse_scope(o,function(a,e){var g=[],h=a.block.loc.start.line-1,i=a.block.loc.start.column,n=a.block.loc.end.line-1,o=a.block.loc.end.column;if("global"===a.type){g.push({x:0,y:0}),g.push({x:l,y:0}),g.push({x:l,y:n*j+j}),g.push({x:0,y:n*j+j}),g.push({x:0,y:0});var q={start:{line:0,column:0},end:{line:m,column:k}};b.push(d(p,a.type,e,g,q)),c.scopes.push({id:p,type:a.type,loc:q})}else{n-1>=h?(g.push({x:i*f,y:h*j}),g.push({x:l,y:h*j}),o<k?(g.push({x:l,y:(n-1)*j+j}),g.push({x:o*f,y:(n-1)*j+j}),g.push({x:o*f,y:n*j+j}),g.push({x:0,y:n*j+j})):(g.push({x:o*f,y:n*j+j}),g.push({x:0,y:n*j+j})),i>0?(g.push({x:0,y:(h+1)*j}),g.push({x:i*f,y:(h+1)*j}),g.push({x:i*f,y:h*j})):g.push({x:0,y:h*j})):(g.push({x:i*f,y:h*j}),g.push({x:o*f,y:h*j}),g.push({x:o*f,y:n*j+j}),g.push({x:i*f,y:n*j+j}),g.push({x:i*f,y:h*j}));var r={start:{line:h,column:i},end:{line:n,column:o}};b.push(d(p,a.type,e,g,r)),c.scopes.push({id:p,type:a.type,loc:r})}p++}),b},a.prototype.draw=function(a){this.layers.one.selectAll("*").remove();var b=j.scaleOrdinal(j.schemeCategory10),c=j.line().x(function(a){return a.x}).y(function(a){return a.y});this.layers.one.selectAll("path").data(a).enter().append("path").attr("id",function(a){return a.id}).attr("class","scope").attr("d",function(a){return c(a.points)}).attr("fill",function(a){return b(a.level)}).attr("stroke","black")},a.prototype.highlight_current_scope=function(a){for(var b=0,c=this.scopes,d=Array.isArray(c),f=0,c=d?c:c[Symbol.iterator]();;){var g;if(d){if(f>=c.length)break;g=c[f++]}else{if(f=c.next(),f.done)break;g=f.value}var h=g;e(a,h.loc)&&(b=h.id)}console.log("currently in scope "+b)},a}())||l)),a("P2_1",m)}}}),System.registerDynamic("prototypes/p3-1.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p3-1.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a){if("global"===a.type)return a.block.loc;var b=a.block.loc,c={start:{line:b.start.line-1,column:b.start.column},end:{line:b.end.line-1,column:b.end.column}};return c}function f(a){a.block.loc.start.line=-(1/0),a.block.loc.start.column=-(1/0),a.block.loc.end.line=1/0,a.block.loc.end.column=1/0}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P3_1",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P3_1 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P3_1 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P3_1 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("code-minimap -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("code-minimap -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P3_1 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function(a){var b=j.parse_ast(a),c=j.parse_scope(b),d={comment:!0,loc:!0},e=j.tokenize(a,d);f(c);var g=k.hierarchy(c,function(a){return a.childScopes}).eachAfter(function(a){for(var b=a.data,c=0,d=e,f=Array.isArray(d),g=0,d=f?d:d[Symbol.iterator]();;){var h;if(f){if(g>=d.length)break;h=d[g++]}else{if(g=d.next(),g.done)break;h=g.value}var i=h;i.loc.start.line===b.block.loc.start.line&&i.loc.start.column===b.block.loc.start.column&&(a.startIndex=c),i.loc.end.line===b.block.loc.end.line&&i.loc.end.column===b.block.loc.end.column&&(a.endIndex=c),"global"===b.type&&(a.startIndex=0,a.endIndex=e.length-1),c++}}).sum(function(a){if(0===a.childScopes.length)return 1}),h=k.treemap().size([this.element.clientWidth-20,this.element.clientHeight-20]).tile(k.treemapSlice).paddingInner(25).paddingOuter(25);h(g);for(var i=g.descendants(),l=k.scaleLinear().domain([0,e.length-1]).range([0,i[0].y1]),m=i,n=Array.isArray(m),o=0,m=n?m:m[Symbol.iterator]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{if(o=m.next(),o.done)break;p=o.value}var q=p;q.yy0=l(q.startIndex),q.yy1=l(q.endIndex)}return i},a.prototype.draw=function(a){var b=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate(10,10)"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);k.scaleOrdinal(k.schemeCategory10);this.group.selectAll("rect").data(a).enter().append("rect").attr("x",function(a){return a.x0}).attr("y",function(a){return a.yy0}).attr("rx",10).attr("ry",10).attr("width",function(a){return a.x1-a.x0}).attr("height",function(a){return a.yy1-a.yy0}).attr("stroke",function(a){return"DUMMY"===a.data.type?"green":"black"}).attr("stroke-width",2).attr("fill","white").on("mouseover",function(a){b.publish("highlight_scope",{range:e(a.data)})}).on("mouseout",function(a){b.publish("unhighlight_scope",{range:e(a.data)})}).on("click",function(a){b.publish("vis_click_event",{range:e(a.data)})}).each(function(a){a.data._D3Binding_=this})},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("rect").attr("fill","white").attr("current","false");var b=null;this.group.selectAll("rect").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("fill","green"),b.attr("current","true"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("rect").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("rect").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).attr("stroke","red")},a}())||m)),a("P3_1",n)}}}),System.registerDynamic("prototypes/p3-2.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p3-2.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a){if("global"===a.type)return a.block.loc;var b=a.block.loc,c={start:{line:b.start.line-1,column:b.start.column},end:{line:b.end.line-1,column:b.end.column}};return c}function f(a){a.block.loc.start.line=-(1/0),a.block.loc.start.column=-(1/0),a.block.loc.end.line=1/0,a.block.loc.end.column=1/0}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P3_2",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P3_2 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P3_2 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P3_2 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("code-minimap -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("code-minimap -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P3_2 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function b(a){var c=j.parse_ast(a),d=j.parse_scope(c),e={comment:!0,loc:!0},g=j.tokenize(a,e);f(d);var h=k.hierarchy(d,function(a){return a.childScopes}).eachAfter(function(a){for(var b=a.data,c=0,d=g,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var h;if(e){if(f>=d.length)break;h=d[f++]}else{if(f=d.next(),f.done)break;h=f.value}var i=h;i.loc.start.line===b.block.loc.start.line&&i.loc.start.column===b.block.loc.start.column&&(a.startIndex=c),i.loc.end.line===b.block.loc.end.line&&i.loc.end.column===b.block.loc.end.column&&(a.endIndex=c),"global"===b.type&&(a.startIndex=0,a.endIndex=g.length-1),c++}}).sum(function(a){if(0===a.childScopes.length)return 1}),b=k.partition().size([this.element.clientHeight-20,this.element.clientWidth-20]);b(h);for(var i=h.descendants(),l=k.scaleLinear().domain([0,g.length-1]).range([0,i[0].x1]),m=i,n=Array.isArray(m),o=0,m=n?m:m[Symbol.iterator]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{if(o=m.next(),o.done)break;p=o.value}var q=p;q.xx0=l(q.startIndex),q.xx1=l(q.endIndex)}return i},a.prototype.draw=function(a){var b=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate(10,10)"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);k.scaleOrdinal(k.schemeCategory10);this.group.selectAll("rect").data(a).enter().append("rect").attr("x",function(a){return a.y0}).attr("y",function(a){return a.xx0}).attr("width",function(a){return a.y1-a.y0}).attr("height",function(a){return a.xx1-a.xx0}).attr("stroke","black").attr("stroke-width",2).attr("fill","white").on("mouseover",function(a){b.publish("highlight_scope",{range:e(a.data)})}).on("mouseout",function(a){b.publish("unhighlight_scope",{range:e(a.data)})}).on("click",function(a){b.publish("vis_click_event",{range:e(a.data)})}).each(function(a){a.data._D3Binding_=this})},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("rect").attr("fill","white").attr("current","false");var b=null;this.group.selectAll("rect").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("fill","green"),b.attr("current","true"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("rect").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("rect").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).attr("stroke","red")},a}())||m)),a("P3_2",n)}}}),System.registerDynamic("prototypes/p3-3.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p3-3.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a){if("global"===a.type)return a.block.loc;var b=a.block.loc,c={start:{line:b.start.line-1,column:b.start.column},end:{line:b.end.line-1,column:b.end.column}};return c}function f(a){a.block.loc.start.line=-(1/0),a.block.loc.start.column=-(1/0),a.block.loc.end.line=1/0,a.block.loc.end.column=1/0}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P3_3",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P3_3 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P3_3 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P3_3 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("code-minimap -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("code-minimap -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P3_3 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function b(a){var c=j.parse_ast(a),d=j.parse_scope(c),e={comment:!0,loc:!0},g=j.tokenize(a,e);f(d);var h=k.hierarchy(d,function(a){return a.childScopes}).eachAfter(function(a){for(var b=a.data,c=0,d=g,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var h;if(e){if(f>=d.length)break;h=d[f++]}else{if(f=d.next(),f.done)break;h=f.value}var i=h;i.loc.start.line===b.block.loc.start.line&&i.loc.start.column===b.block.loc.start.column&&(a.startIndex=c),i.loc.end.line===b.block.loc.end.line&&i.loc.end.column===b.block.loc.end.column&&(a.endIndex=c),"global"===b.type&&(a.startIndex=0,a.endIndex=g.length-1),c++}}).sum(function(a){if(0===a.childScopes.length)return 1}),b=k.partition().size([this.element.clientHeight-20,this.element.clientWidth-20]);b(h);for(var i=h.descendants(),l=k.scaleLinear().domain([0,g.length-1]).range([0,i[0].x1]),m=i,n=Array.isArray(m),o=0,m=n?m:m[Symbol.iterator]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{if(o=m.next(),o.done)break;p=o.value}var q=p;q.xx0=l(q.startIndex),q.xx1=l(q.endIndex),q.lineInfo=[];var r=q.y1-q.y0,s=q.xx1-q.xx0;q.lineInfo.push({x:q.y0+r/2,y:q.xx0}),q.lineInfo.push({x:q.y0,y:q.xx0}),q.lineInfo.push({x:q.y0,y:q.xx0+s}),q.lineInfo.push({x:q.y0+r/2,y:q.xx0+s})}return i},a.prototype.draw=function(a){var b=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate(10,10)"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);var c=(k.scaleOrdinal(k.schemeCategory10),k.line().x(function(a){return a.x}).y(function(a){return a.y}));this.group.selectAll("g").data(a).enter().append("g").on("mouseover",function(a){b.publish("highlight_scope",{range:e(a.data)})}).on("mouseout",function(a){b.publish("unhighlight_scope",{range:e(a.data)})}).on("click",function(a){b.publish("vis_click_event",{range:e(a.data)})}).each(function(a){a.data._D3Binding_=this}).selectAll("path").data(function(a){return[a.lineInfo]}).enter().append("path").attr("d",c).attr("stroke","black").attr("stroke-width",2).attr("fill","white")},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("g").selectAll("path").attr("fill","white"),this.group.selectAll("g").attr("current","false");var b=null;this.group.selectAll("g").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("current","true"),b.select("path").attr("fill","green"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("g").selectAll("path").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("g").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).selectAll("path").attr("stroke","red")},a}())||m)),a("P3_3",n)}}}),System.registerDynamic("prototypes/p4-1.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p4-1.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a,b){b.block.loc.start.line=-(1/0),b.block.loc.start.column=-(1/0),b.block.loc.end.line=1/0,b.block.loc.end.column=1/0}function f(a){if("global"===a.type)return a.block.loc;var b=a.block.loc,c={start:{line:b.start.line-1,column:b.start.column},end:{line:b.end.line-1,column:b.end.column}};return c}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P4_1",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P4_1 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P4_1 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight).style("border-right","1px solid white"),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P4_1 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("P4_1 -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("P4_1 -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P4_1 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function(a){var b=j.parse_ast(a),c=j.parse_scope(b);e(a,c);var d=k.hierarchy(c,function(a){return a.childScopes}).sum(function(a){if(0===a.childScopes.length)return 1}),f=k.treemap().size([this.element.clientWidth-20,this.element.clientHeight-20]).tile(k.treemapSlice).paddingInner(25).paddingOuter(25);return f(d),d.descendants()},a.prototype.draw=function(a){var b=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate(10,10)"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);k.scaleOrdinal(k.schemeCategory10);this.group.selectAll("rect").data(a).enter().append("rect").attr("x",function(a){return a.x0}).attr("y",function(a){return a.y0}).attr("rx",10).attr("ry",10).attr("width",function(a){return a.x1-a.x0}).attr("height",function(a){return a.y1-a.y0}).attr("stroke","black").attr("stroke-width",2).attr("fill","white").on("mouseover",function(a){b.publish("highlight_scope",{range:f(a.data)})}).on("mouseout",function(a){b.publish("unhighlight_scope",{range:f(a.data)})}).on("click",function(a){b.publish("vis_click_event",{range:f(a.data)})}).each(function(a){a.data._D3Binding_=this})},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("rect").attr("fill","white").attr("current","false");var b=null;this.group.selectAll("rect").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("fill","green"),b.attr("current","true"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("rect").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("rect").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).attr("stroke","red")},a}())||m)),a("P4_1",n)}}}),System.registerDynamic("prototypes/p4-2.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p4-2.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a){if("global"===a.type)return a.block.loc;var b=a.block.loc,c={start:{line:b.start.line-1,column:b.start.column},end:{line:b.end.line-1,column:b.end.column}};return c}function f(a){a.block.loc.start.line=-(1/0),a.block.loc.start.column=-(1/0),a.block.loc.end.line=1/0,a.block.loc.end.column=1/0}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P4_2",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P4_2 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P4_2 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P4_2 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("code-minimap -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("code-minimap -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P4_2 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function b(a){var c=j.parse_ast(a),d=j.parse_scope(c),e={comment:!0,loc:!0},g=j.tokenize(a,e);f(d);var h=k.hierarchy(d,function(a){return a.childScopes}).eachAfter(function(a){for(var b=a.data,c=0,d=g,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var h;if(e){if(f>=d.length)break;h=d[f++]}else{if(f=d.next(),f.done)break;h=f.value}var i=h;i.loc.start.line===b.block.loc.start.line&&i.loc.start.column===b.block.loc.start.column&&(a.startIndex=c),i.loc.end.line===b.block.loc.end.line&&i.loc.end.column===b.block.loc.end.column&&(a.endIndex=c),"global"===b.type&&(a.startIndex=0,a.endIndex=g.length-1),c++}}).sum(function(a){if(0===a.childScopes.length)return 1}),b=k.partition().size([this.element.clientHeight-20,this.element.clientWidth-20]);b(h);for(var i=h.descendants(),l=k.scaleLinear().domain([0,g.length-1]).range([0,i[0].y1]),m=i,n=Array.isArray(m),o=0,m=n?m:m[Symbol.iterator]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{if(o=m.next(),o.done)break;p=o.value}var q=p;q.yy0=l(q.startIndex),q.yy1=l(q.endIndex)}return i},a.prototype.draw=function(a){this.nodes=a;var b=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate(10,10)"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);k.scaleOrdinal(k.schemeCategory10);this.group.selectAll("rect").data(a).enter().append("rect").attr("x",function(a){return a.y0}).attr("y",function(a){return a.x0}).attr("width",function(a){return a.y1-a.y0}).attr("height",function(a){return a.x1-a.x0}).attr("stroke","black").attr("stroke-width",2).attr("fill","white").on("mouseover",function(a){b.publish("highlight_scope",{range:e(a.data)})}).on("mouseout",function(a){b.publish("unhighlight_scope",{range:e(a.data)})}).on("click",function(a){b.publish("vis_click_event",{range:e(a.data)})}).each(function(a){a.data._D3Binding_=this})},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("rect").attr("fill","white").attr("current","false");var b=null;this.group.selectAll("rect").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("fill","green"),b.attr("current","true"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("rect").attr("stroke","black"),this.draw(this.nodes)},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("rect").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).attr("stroke","red").raise()},a}())||m)),a("P4_2",n)}}}),System.registerDynamic("prototypes/p4-3.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>";
}.call(this)}),System.register("prototypes/p4-3.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a){if("global"===a.type)return a.block.loc;var b=a.block.loc,c={start:{line:b.start.line-1,column:b.start.column},end:{line:b.end.line-1,column:b.end.column}};return c}function f(a){a.block.loc.start.line=-(1/0),a.block.loc.start.column=-(1/0),a.block.loc.end.line=1/0,a.block.loc.end.column=1/0}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P4_3",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P4_3 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P4_3 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P4_3 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("code-minimap -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("code-minimap -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P4_3 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function b(a){var c=j.parse_ast(a),d=j.parse_scope(c),e={comment:!0,loc:!0},g=j.tokenize(a,e);f(d);var h=k.hierarchy(d,function(a){return a.childScopes}).eachAfter(function(a){for(var b=a.data,c=0,d=g,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var h;if(e){if(f>=d.length)break;h=d[f++]}else{if(f=d.next(),f.done)break;h=f.value}var i=h;i.loc.start.line===b.block.loc.start.line&&i.loc.start.column===b.block.loc.start.column&&(a.startIndex=c),i.loc.end.line===b.block.loc.end.line&&i.loc.end.column===b.block.loc.end.column&&(a.endIndex=c),"global"===b.type&&(a.startIndex=0,a.endIndex=g.length-1),c++}}).sum(function(a){if(0===a.childScopes.length)return 1}),b=k.partition().size([this.element.clientHeight-20,this.element.clientWidth-20]);b(h);for(var i=h.descendants(),l=(k.scaleLinear().domain([0,g.length-1]).range([0,i[0].x1]),i),m=Array.isArray(l),n=0,l=m?l:l[Symbol.iterator]();;){var o;if(m){if(n>=l.length)break;o=l[n++]}else{if(n=l.next(),n.done)break;o=n.value}var p=o;p.lineInfo=[];var q=p.y1-p.y0,r=p.x1-p.x0;p.lineInfo.push({x:p.y0+q/2,y:p.x0}),p.lineInfo.push({x:p.y0,y:p.x0}),p.lineInfo.push({x:p.y0,y:p.x0+r}),p.lineInfo.push({x:p.y0+q/2,y:p.x0+r})}return i},a.prototype.draw=function(a){var b=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate(10,10)"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);var c=(k.scaleOrdinal(k.schemeCategory10),k.line().x(function(a){return a.x}).y(function(a){return a.y}));this.group.selectAll("g").data(a).enter().append("g").on("mouseover",function(a){b.publish("highlight_scope",{range:e(a.data)})}).on("mouseout",function(a){b.publish("unhighlight_scope",{range:e(a.data)})}).on("click",function(a){b.publish("vis_click_event",{range:e(a.data)})}).each(function(a){a.data._D3Binding_=this}).selectAll("path").data(function(a){return[a.lineInfo]}).enter().append("path").attr("d",c).attr("stroke","black").attr("stroke-width",2).attr("fill","white")},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("g").selectAll("path").attr("fill","white"),this.group.selectAll("g").attr("current","false");var b=null;this.group.selectAll("g").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("current","true"),b.select("path").attr("fill","green"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("g").selectAll("path").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("g").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).selectAll("path").attr("stroke","red")},a}())||m)),a("P4_3",n)}}}),System.registerDynamic("prototypes/p4-4.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p4-4.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a){if("global"===a.type)return a.block.loc;var b=a.block.loc,c={start:{line:b.start.line-1,column:b.start.column},end:{line:b.end.line-1,column:b.end.column}};return c}function f(a){a.block.loc.start.line=-(1/0),a.block.loc.start.column=-(1/0),a.block.loc.end.line=1/0,a.block.loc.end.column=1/0}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P4_4",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P4_4 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P4_4 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P4_4 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("code-minimap -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("code-minimap -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P4_4 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function b(a){var c=j.parse_ast(a),d=j.parse_scope(c),e={comment:!0,loc:!0};j.tokenize(a,e);f(d);var g=k.hierarchy(d,function(a){return a.childScopes}),b=k.cluster().size([this.element.clientHeight-20,this.element.clientWidth-20]);return b(g),g.descendants()},a.prototype.draw=function(a){var b=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate(10,10)"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);var c=(this.group.selectAll(".link").data(a.slice(1)).enter().append("path").attr("stroke","black").attr("fill","none").attr("d",function(a){return"M"+a.y+","+a.x+"C"+(a.parent.y+4)+","+a.x+" "+(a.parent.y+4)+","+a.parent.x+" "+a.parent.y+","+a.parent.x}),this.group.selectAll(".node").data(a).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+a.y+","+a.x+")"}).on("mouseover",function(a){b.publish("highlight_scope",{range:e(a.data)})}).on("mouseout",function(a){b.publish("unhighlight_scope",{range:e(a.data)})}).on("click",function(a){b.publish("vis_click_event",{range:e(a.data)})}).each(function(a){a.data._D3Binding_=this}));c.append("circle").attr("r",8).attr("fill","white").attr("stroke","black")},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll(".node").selectAll("circle").attr("fill","white"),this.group.selectAll(".node").attr("current","false");var b=null;this.group.selectAll(".node").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("current","true"),b.select("circle").attr("fill","green"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll(".node").selectAll("circle").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll(".node").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).select("circle").attr("stroke","red")},a}())||m)),a("P4_4",n)}}}),System.registerDynamic("prototypes/p4-5.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p4-5.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a){if("global"===a.type)return a.block.loc;var b=a.block.loc,c={start:{line:b.start.line-1,column:b.start.column},end:{line:b.end.line-1,column:b.end.column}};return c}function f(a){a.block.loc.start.line=-(1/0),a.block.loc.start.column=-(1/0),a.block.loc.end.line=1/0,a.block.loc.end.column=1/0}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P4_5",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P4_5 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P4_5 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P4_5 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("code-minimap -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("code-minimap -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P4_5 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function b(a){var c=j.parse_ast(a),d=j.parse_scope(c),e={comment:!0,loc:!0};j.tokenize(a,e);f(d);var g=k.hierarchy(d,function(a){return a.childScopes}),b=k.tree().size([this.element.clientHeight-20,this.element.clientWidth-20]);return b(g),g.descendants()},a.prototype.draw=function(a){var b=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate(10,10)"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);var c=(this.group.selectAll(".link").data(a.slice(1)).enter().append("path").attr("stroke","black").attr("fill","none").attr("d",function(a){return"M"+a.y+","+a.x+"C"+(a.parent.y+4)+","+a.x+" "+(a.parent.y+4)+","+a.parent.x+" "+a.parent.y+","+a.parent.x}),this.group.selectAll(".node").data(a).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+a.y+","+a.x+")"}).on("mouseover",function(a){b.publish("highlight_scope",{range:e(a.data)})}).on("mouseout",function(a){b.publish("unhighlight_scope",{range:e(a.data)})}).on("click",function(a){b.publish("vis_click_event",{range:e(a.data)})}).each(function(a){a.data._D3Binding_=this}));c.append("circle").attr("r",8).attr("fill","white").attr("stroke","black")},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll(".node").selectAll("circle").attr("fill","white"),this.group.selectAll(".node").attr("current","false");var b=null;this.group.selectAll(".node").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("current","true"),b.select("circle").attr("fill","green"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll(".node").selectAll("circle").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll(".node").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).select("circle").attr("stroke","red")},a}())||m)),a("P4_5",n)}}}),System.registerDynamic("prototypes/p4-6.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p4-6.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a){if("global"===a.type)return a.block.loc;var b=a.block.loc,c={start:{line:b.start.line-1,column:b.start.column},end:{line:b.end.line-1,column:b.end.column}};return c}function f(a){a.block.loc.start.line=-(1/0),a.block.loc.start.column=-(1/0),a.block.loc.end.line=1/0,a.block.loc.end.column=1/0}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P4_6",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P4_6 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P4_6 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P4_6 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("code-minimap -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("code-minimap -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P4_6 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function b(a){var c=j.parse_ast(a),d=j.parse_scope(c),e={comment:!0,loc:!0};j.tokenize(a,e);f(d);var g=k.hierarchy(d,function(a){return a.childScopes}),b=k.cluster().size([2*Math.PI,this.element.clientWidth/2-20]).separation(function(a,b){return(a.parent==b.parent?1:2)/a.depth});return b(g),g},a.prototype.draw=function(a){function b(a,b){return[(b=+b)*Math.cos(a-=Math.PI/2),b*Math.sin(a)]}var c=this,d=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate("+c.element.clientWidth/2+","+c.element.clientHeight/2+")"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);var f=(this.group.selectAll(".link").data(a.links()).enter().append("path").attr("stroke","black").attr("fill","none").attr("d",k.linkRadial().angle(function(a){return a.x}).radius(function(a){return a.y})),this.group.selectAll(".node").data(a.descendants()).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+b(a.x,a.y)+")"}).on("mouseover",function(a){d.publish("highlight_scope",{range:e(a.data)})}).on("mouseout",function(a){d.publish("unhighlight_scope",{range:e(a.data)})}).on("click",function(a){d.publish("vis_click_event",{range:e(a.data)})}).each(function(a){a.data._D3Binding_=this}));f.append("circle").attr("r",8).attr("fill","white").attr("stroke","black")},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll(".node").selectAll("circle").attr("fill","white"),this.group.selectAll(".node").attr("current","false");var b=null;this.group.selectAll(".node").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("current","true"),b.select("circle").attr("fill","green"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll(".node").selectAll("circle").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll(".node").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).select("circle").attr("stroke","red")},a}())||m)),a("P4_6",n)}}}),System.registerDynamic("prototypes/p4-7.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p4-7.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a){if("global"===a.type)return a.block.loc;var b=a.block.loc,c={start:{line:b.start.line-1,column:b.start.column},end:{line:b.end.line-1,column:b.end.column}};return c}function f(a){a.block.loc.start.line=-(1/0),a.block.loc.start.column=-(1/0),a.block.loc.end.line=1/0,a.block.loc.end.column=1/0}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P4_7",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P4_7 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P4_7 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P4_7 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("code-minimap -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("code-minimap -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P4_7 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function b(a){var c=j.parse_ast(a),d=j.parse_scope(c),e={comment:!0,loc:!0};j.tokenize(a,e);f(d);var g=k.hierarchy(d,function(a){return a.childScopes}),b=k.tree().size([2*Math.PI,this.element.clientWidth/2-20]).separation(function(a,b){return(a.parent==b.parent?1:2)/a.depth});return b(g),g},a.prototype.draw=function(a){function b(a,b){return[(b=+b)*Math.cos(a-=Math.PI/2),b*Math.sin(a)]}var c=this,d=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate("+c.element.clientWidth/2+","+c.element.clientHeight/2+")"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);var f=(this.group.selectAll(".link").data(a.links()).enter().append("path").attr("stroke","black").attr("fill","none").attr("d",k.linkRadial().angle(function(a){return a.x}).radius(function(a){return a.y})),this.group.selectAll(".node").data(a.descendants()).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+b(a.x,a.y)+")"}).on("mouseover",function(a){d.publish("highlight_scope",{range:e(a.data)})}).on("mouseout",function(a){d.publish("unhighlight_scope",{range:e(a.data)})}).on("click",function(a){d.publish("vis_click_event",{range:e(a.data)})}).each(function(a){a.data._D3Binding_=this}));f.append("circle").attr("r",8).attr("fill","white").attr("stroke","black")},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll(".node").selectAll("circle").attr("fill","white"),this.group.selectAll(".node").attr("current","false");var b=null;this.group.selectAll(".node").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("current","true"),b.select("circle").attr("fill","green"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll(".node").selectAll("circle").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll(".node").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).select("circle").attr("stroke","red")},a}())||m)),a("P4_7",n)}}}),System.registerDynamic("prototypes/p4-8.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p4-8.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a,b){b.block.loc.start.line=-(1/0),b.block.loc.start.column=-(1/0),b.block.loc.end.line=1/0,b.block.loc.end.column=1/0}function f(a){var b={start:{line:a.start.line-1,column:a.start.column},end:{line:a.end.line-1,column:a.end.column}};return b}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P4_8",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P4_8 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P4_8 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight).style("border-right","1px solid white"),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P4_8 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("P4_8 -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("P4_8 -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P4_8 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function(a){var b=j.parse_ast(a),c=j.parse_scope(b);e(a,c);var d=this.element.clientWidth,f=this.element.clientHeight,g=Math.min(d,f)/2-10,h=k.partition().size([2*Math.PI,g]),i=k.arc().startAngle(function(a){return a.x0}).endAngle(function(a){return a.x1}).innerRadius(function(a){return a.y0}).outerRadius(function(a){return a.y1-2}).padAngle(.02),l=k.hierarchy(c,function(a){return a.childScopes}).sum(function(a){if(0===a.childScopes.length)return 1});return h(l),{data:l.descendants(),arc:i}},a.prototype.draw=function(a){var b=this,c=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate("+b.element.clientWidth/2+","+b.element.clientHeight/2+")"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);k.scaleOrdinal(k.schemeCategory10);this.group.selectAll("path").data(a.data).enter().append("path").attr("d",a.arc).attr("stroke","black").attr("stroke-width",1).attr("fill","white").on("mouseover",function(a){c.publish("highlight_scope",{range:f(a.data.block.loc)})}).on("mouseout",function(a){c.publish("unhighlight_scope",{range:f(a.data.block.loc)})}).on("click",function(a){c.publish("vis_click_event",{range:f(a.data.block.loc)})}).each(function(a){a.data._D3Binding_=this})},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("path").attr("fill","white").attr("current","false");var b=null;this.group.selectAll("path").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("fill","green"),b.attr("current","true"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("path").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("path").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).attr("stroke","red")},a}())||m)),a("P4_8",n)}}}),System.registerDynamic("prototypes/p5-1.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p5-1.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a,b){b.block.loc.start.line=-(1/0),b.block.loc.start.column=-(1/0),b.block.loc.end.line=1/0,b.block.loc.end.column=1/0}function f(a){var b={start:{line:a.start.line-1,column:a.start.column},end:{line:a.end.line-1,column:a.end.column}};return b}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P5_1",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P5_1 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P5_1 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight).style("border-right","1px solid white"),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P5_1 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("P5_1 -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("P5_1 -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P5_1 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function(a){var b=j.parse_ast(a),c=j.parse_scope(b),d={comment:!0,loc:!0},f=j.tokenize(a,d);e(a,c);var g=k.hierarchy(c,function(a){return a.childScopes}).eachBefore(function(a){console.log("eachBefore");var b=a.data;a.data.tokenSize=0;for(var c=!1,d=f,e=Array.isArray(d),g=0,d=e?d:d[Symbol.iterator]();;){var h;if(e){if(g>=d.length)break;h=d[g++]}else{if(g=d.next(),g.done)break;h=g.value}var i=h;i.loc.start.line===b.block.loc.start.line&&i.loc.start.column===b.block.loc.start.column&&(c=!0),c===!0&&a.data.tokenSize++,i.loc.end.line===b.block.loc.end.line&&i.loc.end.column===b.block.loc.end.column&&(c=!1),"global"===b.type&&(a.data.tokenSize=f.length)}}).eachAfter(function(a){console.log("eachAfter");var b=0;if(a.children){a.children.forEach(function(a){b+=a.data.tokenSize});var c=a.data.tokenSize-b;c>0&&(console.log("true"),
a.children.push({data:{type:"FAKE",tokenSize:c,childScopes:[]}}))}}).sum(function(a){return a.tokenSize}),h=k.pack().size([this.element.clientWidth-20,this.element.clientHeight-20]).padding(10);h(g);var i=g.descendants().filter(function(a){return"FAKE"!==a.data.type});return i},a.prototype.draw=function(a){var b=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate(10,10)"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);k.scaleOrdinal(k.schemeCategory10),this.group.selectAll("g").data(a).enter().append("g").attr("transform",function(a){return"translate("+[a.x,a.y]+")"}).append("circle").attr("cx",function(a){return a.x0}).attr("cy",function(a){return a.y0}).attr("r",function(a){return a.r}).attr("stroke","black").attr("stroke-width",2).attr("fill","white").on("mouseover",function(a){b.publish("highlight_scope",{range:f(a.data.block.loc)})}).on("mouseout",function(a){b.publish("unhighlight_scope",{range:f(a.data.block.loc)})}).on("click",function(a){b.publish("vis_click_event",{range:f(a.data.block.loc)})}).each(function(a){a.data._D3Binding_=this})},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("circle").attr("fill","white").attr("current","false");var b=null;this.group.selectAll("circle").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("fill","green"),b.attr("current","true"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("circle").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("circle").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).attr("stroke","red")},a}())||m)),a("P5_1",n)}}}),System.registerDynamic("prototypes/p5-2.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p5-2.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a,b){b.block.loc.start.line=-(1/0),b.block.loc.start.column=-(1/0),b.block.loc.end.line=1/0,b.block.loc.end.column=1/0}function f(a){var b={start:{line:a.start.line-1,column:a.start.column},end:{line:a.end.line-1,column:a.end.column}};return b}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P5_2",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P4_5 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P5_2 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight).style("border-right","1px solid white"),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P5_2 -- draw_001 event");var c=b.content;a.layout(c)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("P5_2 -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("P5_2 -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P5_2 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function(a){function b(a){k.event.active||p.alphaTarget(.3).restart(),a.fx=a.x,a.fy=a.y}function c(a){a.fx=k.event.x,a.fy=k.event.y}function d(a){k.event.active||p.alphaTarget(0),a.fx=null,a.fy=null}var g=this.eventAggregator,h=j.parse_ast(a),i=j.parse_scope(h),l={comment:!0,loc:!0},m=j.tokenize(a,l);e(a,i);var n=k.hierarchy(i,function(a){return a.childScopes}).eachAfter(function(a){var b=a.data;a.tokenSize=0;for(var c=0,d=!1,e=m,f=Array.isArray(e),g=0,e=f?e:e[Symbol.iterator]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{if(g=e.next(),g.done)break;h=g.value}var i=h;i.loc.start.line===b.block.loc.start.line&&i.loc.start.column===b.block.loc.start.column&&(a.startIndex=c,d=!0),d===!0&&a.tokenSize++,i.loc.end.line===b.block.loc.end.line&&i.loc.end.column===b.block.loc.end.column&&(a.endIndex=c,d=!1),"global"===b.type&&(a.startIndex=0,a.endIndex=m.length-1,a.tokenSize=m.length),c++}}).sum(function(a){if(0===a.childScopes.length)return 1}),o=k.scaleLinear().domain([0,m.length]).range([1,40]);this.group.selectAll("*").remove();var p=k.forceSimulation().force("link",k.forceLink().id(function(a){return a.index})).force("collide",k.forceCollide(function(a){return 30}).iterations(16)).force("charge",k.forceManyBody()).force("center",k.forceCenter(this.element.clientWidth/2,this.element.clientHeight/3)).force("y",k.forceY(0)).force("x",k.forceX(0)),q=this.group.append("g").attr("class","links").selectAll("line").data(n.links()).enter().append("line").attr("stroke","black"),r=this.group.append("g").attr("class","nodes").selectAll("circle").data(n.descendants()).enter().append("circle").attr("r",function(a){return o(a.tokenSize)}).attr("fill","white").on("mouseover",function(a){g.publish("highlight_scope",{range:f(a.data.block.loc)})}).on("mouseout",function(a){g.publish("unhighlight_scope",{range:f(a.data.block.loc)})}).on("click",function(a){g.publish("vis_click_event",{range:f(a.data.block.loc)})}).each(function(a){a.data._D3Binding_=this}).call(k.drag().on("start",b).on("drag",c).on("end",d)),s=function(){q.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),r.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})};p.nodes(n.descendants()).on("tick",s),p.force("link").links(n.links())},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("circle").attr("fill","white").attr("current","false");var b=null;this.group.selectAll("circle").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("fill","green"),b.attr("current","true"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("circle").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("circle").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).attr("stroke","red")},a}())||m)),a("P5_2",n)}}}),System.registerDynamic("prototypes/p6-1.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("prototypes/p6-1.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a,b){b.block.loc.start.line=-(1/0),b.block.loc.start.column=-(1/0),b.block.loc.end.line=1/0,b.block.loc.end.column=1/0}function f(a){var b={start:{line:a.start.line-1,column:a.start.column},end:{line:a.end.line-1,column:a.end.column}};return b}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P6_1",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P6_1 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P6_1 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight).style("border-right","1px solid white"),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P6_1 -- draw_001 event");var c=b.content,d=a.layout(c);a.draw(d)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("P6_1 -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("P6_1 -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P6_1 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function(a){var b=j.parse_ast(a),c=j.parse_scope(b);e(a,c);var d=k.hierarchy(c,function(a){return a.childScopes}).sum(function(a){if(0===a.childScopes.length)return 1}),f=k.pack().size([this.element.clientWidth-20,this.element.clientHeight-20]).padding(10);return f(d),d.descendants()},a.prototype.draw=function(a){var b=this.eventAggregator;this.group.selectAll("*").remove(),this.group.attr("transform",function(a){return"translate(10,10)"}),this.svg.attr("width",this.element.clientWidth),this.svg.attr("height",this.element.clientHeight);k.scaleOrdinal(k.schemeCategory10),this.group.selectAll("g").data(a).enter().append("g").attr("transform",function(a){return"translate("+[a.x,a.y]+")"}).append("circle").attr("cx",function(a){return a.x0}).attr("cy",function(a){return a.y0}).attr("r",function(a){return a.r}).attr("stroke","black").attr("stroke-width",2).attr("fill","white").on("mouseover",function(a){b.publish("highlight_scope",{range:f(a.data.block.loc)})}).on("mouseout",function(a){b.publish("unhighlight_scope",{range:f(a.data.block.loc)})}).on("click",function(a){b.publish("vis_click_event",{range:f(a.data.block.loc)})}).each(function(a){a.data._D3Binding_=this})},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("circle").attr("fill","white").attr("current","false");var b=null;this.group.selectAll("circle").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("fill","green"),b.attr("current","true"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("circle").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("circle").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).attr("stroke","red")},a}())||m)),a("P6_1",n)}}}),System.registerDynamic("prototypes/p6-2.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return"<template></template>"}.call(this)}),System.register("services/log.js",["aurelia-framework"],function(a,b){"use strict";var c,d;return{setters:[function(a){c=a.LogManager}],execute:function(){a("log",d=c.getLogger("insight")),a("log",d)}}}),System.register("services/parser.js",["esprima","escope","escodegen"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g;return{setters:[function(a){d=a},function(a){e=a},function(a){f=a}],execute:function(){g=function(){function a(){c(this,a)}return a.prototype.parse_ast=function(a){var b=d.parseScript(a,{loc:!0,tolerant:!0,comment:!0});return b},a.prototype.parse_scope=function(a){var b=e.analyze(a,{ecmaVersion:6}),c=b.acquire(a);return c},a.prototype.traverse_scope=function(a,b){var c=0,d=function e(a,b,d){a.upper?a.uuid=a.upper.uuid+"-"+d:a.uuid=d,b&&b(a,c);for(var f=0,g=a.childScopes,h=Array.isArray(g),i=0,g=h?g:g[Symbol.iterator]();;){var j;if(h){if(i>=g.length)break;j=g[i++]}else{if(i=g.next(),i.done)break;j=i.value}var k=j;c++,e(k,b,f),c--,f++}};d(a,b,0)},a.prototype.tokenize=function(a,b){var c=b||{loc:!0,comment:!0},e=d.tokenize(a,c);return e},a.prototype.generate_code=function(a,b){var c=f.generate(a,b);return c},a}(),a("default",new g)}}}),System.register("prototypes/p6-2.js",["aurelia-framework","aurelia-event-aggregator","../services/log","../services/parser.js","d3"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){var c=!1,d=!1;return a.line===b.start.line?a.column>b.start.column&&(c=!0):a.line>b.start.line&&(c=!0),a.line===b.end.line?a.column<b.end.column&&(d=!0):a.line<b.end.line&&(d=!0),!(!c||!d)}function e(a,b){b.block.loc.start.line=-(1/0),b.block.loc.start.column=-(1/0),b.block.loc.end.line=1/0,b.block.loc.end.column=1/0}function f(a){var b={start:{line:a.start.line-1,column:a.start.column},end:{line:a.end.line-1,column:a.end.column}};return b}var g,h,i,j,k,l,m,n;return{setters:[function(a){g=a.inject},function(a){h=a.EventAggregator},function(a){i=a.log},function(a){j=a["default"]},function(a){k=a}],execute:function(){a("P6_2",(l=g(h),n=l(m=function(){function a(b){c(this,a),i.info("P4_5 created"),this.eventAggregator=b,this.subs=[]}return a.prototype.attached=function(){var a=this;i.info("P6_2 attached"),this.element=document.querySelector("#vis-viewport"),i.info("Inizialising SVG @ "+this.element.clientWidth+" x "+this.element.clientHeight),this.svg=k.select(this.element).append("svg").style("display","block").attr("width",this.element.clientWidth).attr("height",this.element.clientHeight).style("border-right","1px solid white"),this.group=this.svg.append("g").attr("id","layer-1");var b=this.eventAggregator.subscribe("draw_001",function(b){i.info("P6_2 -- draw_001 event");var c=b.content;a.layout(c)}),c=this.eventAggregator.subscribe("cursorActivity",function(b){i.info("P6_2 -- cursorActivity event"),a.reset_show_var_scope(),a.highlight_current_scope(b)}),d=this.eventAggregator.subscribe("editorTextSelection",function(b){i.info("P6_2 -- cursorActivity event"),a.show_var_scope(b.selection)});this.subs.push(b),this.subs.push(c),this.subs.push(d)},a.prototype.detached=function(){i.info("P6_2 detached"),this.element.innerHTML="";for(var a=this.subs,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.layout=function(a){function b(a){k.event.active||m.alphaTarget(.3).restart(),a.fx=a.x,a.fy=a.y}function c(a){a.fx=k.event.x,a.fy=k.event.y}function d(a){k.event.active||m.alphaTarget(0),a.fx=null,a.fy=null}var g=this.eventAggregator,h=j.parse_ast(a),i=j.parse_scope(h);e(a,i);var l=k.hierarchy(i,function(a){return a.childScopes}).sum(function(a){if(0===a.childScopes.length)return 1});this.group.selectAll("*").remove();var m=k.forceSimulation().force("link",k.forceLink().id(function(a){return a.index})).force("collide",k.forceCollide(function(a){return 30}).iterations(16)).force("charge",k.forceManyBody()).force("center",k.forceCenter(this.element.clientWidth/2,this.element.clientHeight/3)).force("y",k.forceY(0)).force("x",k.forceX(0)),n=this.group.append("g").attr("class","links").selectAll("line").data(l.links()).enter().append("line").attr("stroke","black"),o=this.group.append("g").attr("class","nodes").selectAll("circle").data(l.descendants()).enter().append("circle").attr("r",20).attr("fill","white").on("mouseover",function(a){g.publish("highlight_scope",{range:f(a.data.block.loc)})}).on("mouseout",function(a){g.publish("unhighlight_scope",{range:f(a.data.block.loc)})}).on("click",function(a){g.publish("vis_click_event",{range:f(a.data.block.loc)})}).each(function(a){a.data._D3Binding_=this}).call(k.drag().on("start",b).on("drag",c).on("end",d)),p=function(){n.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),o.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})};m.nodes(l.descendants()).on("tick",p),m.force("link").links(l.links())},a.prototype.highlight_current_scope=function(a){a.line=a.line+1,this.group.selectAll("circle").attr("fill","white").attr("current","false");var b=null;this.group.selectAll("circle").each(function(c){var e=d(a,c.data.block.loc);e&&(b=k.select(this))}),b&&(b.attr("fill","green"),b.attr("current","true"))},a.prototype.reset_show_var_scope=function(){this.group.selectAll("circle").attr("stroke","black")},a.prototype.show_var_scope=function(a){function b(a,c){for(var d=a.variables,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;if(h.name===c)return a}if(a.upper)return b(a.upper,c)}var c=this.group.selectAll("circle").filter(function(a,b){return"true"===k.select(this).attr("current")}).datum(),d=b(c.data,a);d&&k.select(d._D3Binding_).attr("stroke","red")},a}())||m)),a("P6_2",n)}}}),System.registerDynamic("views/modals/b-three.html!github:systemjs/plugin-text@0.0.8.js",[],!1,function(a,b,c){return function(){return'<template><div class="modal fade" id="minimap-help-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="exampleModalLabel">Mini code-map encodings</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><div class="container-fluid"><div class="row margin-bottom-30"><div class="col-12"><p>The <span class="font-weight-bold" style="background-color:#fffea8">yellow highlighed</span> area on the code mini-map shows in which scope the cursor is currenlty located in.</p><p>The <span class="font-weight-bold" style="color:red">red border</span> on the code mini-map shows to which scope a specific variable belongs to. Highlight, or double click on a variable in the code editor to show this.</p><img class="mx-auto img-fluid" src="./images/examples/b5.png"></div></div><div class="row margin-bottom-20"><div class="col-3"><img class="mx-auto img-fluid" src="./images/examples/b7.png"></div><div class="col-9">In this example the selected variable belongs to the same scope in which the cursor is currenlty located in.</div></div><div class="row"><div class="col-3"><img class="mx-auto img-fluid" src="./images/examples/b6.png"></div><div class="col-9">In this example the selected variable does not belong to the same scope in which the cursor is currenlty located in.</div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button></div></div></div></div></template>'}.call(this)});